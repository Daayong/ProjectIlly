<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.c.illy.member.MemberRepository">

	<select id="getSelect" parameterType="MemberVO"
		resultType="MemberVO">
		SELECT * FROM member WHERE member_id = #{member_id}
	</select>

	<select id="usernameSelect" parameterType="MemberVO"
		resultType="MemberVO">
		SELECT * FROM member WHERE username = #{username}
	</select>

	<select id="find_username" parameterType="String"
		resultMap="getLoginResult">
		select M.*, R.*
		from Member M
		inner join
		member_role MR
		on M.username = MR.username
		inner join
		role R
		on MR.num = R.num
		WHERE M.username=#{username}
	</select>

	<insert id="setInsert" parameterType="MemberVO">
		insert into
		member(username, password, member_name, member_email,member_phone,
		member_birth, enabled) values (
		#{username},
		#{password},
		#{member_name},
		#{member_email},
		#{member_phone},
		#{member_birth},
		#{enabled}
		);
	</insert>
	
	
	
	
	<!-- ijy_point -->
	<insert id="setAddBean" parameterType="MemberVO">
		update member set member_point = #{member_point}
			where member_id = #{member_id}
	</insert> <!-- 결제 후 포인트 변경 -->

	<resultMap type="MemberVO" id="getLoginResult">
		<id column="member_id" property="member_id"/>
		<result column="username" property="username" />
		<result column="password" property="password" />
		<result column="member_name" property="member_name" />
		<result column="member_email" property="member_email" />
		<result column="member_phone" property="member_phone" />
		<result column="member_birth" property="member_birth" />
		<result column="member_point" property="member_point" />
		<result column="enabled" property="enabled" />
		<collection property="roles" javaType="List"
			ofType="RoleVO">
			<result column="num" property="num" />
			<result column="roleName" property="roleName" />
		</collection>
	</resultMap>

	<insert id="setMemberRoleInsert" parameterType="java.util.Map">
		insert into
		member_role(username,num) values(
		#{username}, #{num}
		)
	</insert>
	
	<select id="find_id_useEmail" parameterType="MemberVO" resultType="MemberVO">
		select username from member where member_name = #{member_name} and member_email = #{member_email}
	</select>
</mapper>